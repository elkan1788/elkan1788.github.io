<!doctype html><html lang=en dir=content/en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=content-security-policy content="upgrade-insecure-requests">
<title> Apache Nifi clustering and user authentication with kerberos - Loving life and dreams. </title>
<meta name=keywords content="Blog,Software,Big Data,Product,Architecture,Java,Kylin">
<meta name=author content="Elkan.Li">
<meta property="og:title" content="Apache Nifi clustering and user authentication with kerberos">
<meta property="og:site_name" content="Loving life and dreams.">
<meta property="og:image" content="/img/author.jpg">
<meta name=title content="Apache Nifi clustering and user authentication with kerberos - Loving life and dreams.">
<meta name=description content="Weclome to Elkan's blog site that who is best on program develop, pre-sales and big data.">
<link rel="shortcut icon" href=/img/favicon.ico>
<link rel=apple-touch-icon href=/img/apple-touch-icon.png>
<link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png>
<link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css rel=stylesheet type=text/css>
<link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet>
<link href=/css/main.css rel=stylesheet type=text/css>
<link href=/css/syntax.css rel=stylesheet type=text/css>
<script type=text/javascript>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="https://hm.baidu.com/hm.js?Your BaiduSiteId",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script>
</head>
<body itemscope itemtype=http://schema.org/WebPage lang=zh-hans>
<div class="container one-collumn sidebar-position-left page-home">
<div class=headband></div>
<header id=header class=header itemscope itemtype=http://schema.org/WPHeader>
<div class=header-inner> <div class=site-brand-container>
<div class=site-nav-toggle>
<div class=toggle role=button style=opacity:1;top:0>
<span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span>
</div>
</div>
<div class=site-meta>
<div class=multi-lang-switch>
<i class="fa fa-fw fa-language" style=margin-right:5px></i>
<a class=lang-link id=zh-cn href=https://lisenhui.cn/2017/10/22/ninfi-cluster-deploy-with-kerberos.html>中文</a>
<span class=lang-line> / </span>
<a class=lang-link id=en href=#>English</a>
</div>
<div class=custom-logo-site-title>
<a href=/en/ class=brand rel=start>
<span class=logo-line-before><i></i></span>
<span class=site-title>Loving life and dreams.</span>
<span class=logo-line-after><i></i></span>
</a>
</div>
<p class=site-subtitle>Don't stop running forward!</p>
</div>
<div class=site-nav-right>
<div class="toggle popup-trigger" style=opacity:1;top:0>
<i class="fa fa-search fa-fw fa-lg"></i>
</div>
</div>
</div>
<nav class=site-nav>
<ul id=menu class=menu>
<li class=menu-item>
<a href=/en/ rel=section>
<i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home
</a>
</li>
<li class=menu-item>
<a href=/en/post rel=section>
<i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archive
</a>
</li>
<li class=menu-item>
<a href=/en/about.html rel=section>
<i class="menu-item-icon fa fa-fw fa-user"></i> <br>About
</a>
</li>
<li class=menu-item>
<a href=/en/404.html rel=section target=_blank>
<i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>Page404
</a>
</li>
<li class="menu-item menu-item-search">
<a href=javascript:; class=popup-trigger> <i class="menu-item-icon fa fa-search fa-fw"></i> <br> Search</a>
</li>
</ul>
<div class=site-search>
<div class="popup search-popup local-search-popup">
<div class="local-search-header clearfix">
<span class=search-icon><i class="fa fa-search"></i> </span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span>
<div class=local-search-input-wrapper>
<input autocomplete=off placeholder="Enter key words..." spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off>
</div>
</div>
<div id=local-search-result></div>
</div>
</div>
</nav>
</div>
</header>
<main id=main class=main>
<div class=main-inner>
<div class=content-wrap>
<div id=content class=content>
<section id=posts class=posts-expand>
<article class="post post-type-normal" itemscope itemtype=http://schema.org/Article>
<header class=post-header>
<h1 class=post-title itemprop="name headline">
<a class=post-title-link href=https://lisenhui.cn/en/2017/10/22/ninfi-cluster-deploy-with-kerberos.html itemprop=url>
Apache Nifi clustering and user authentication with kerberos
</a>
</h1>
<div class=post-meta>
<span class=post-time>
<i class="fa fa-calendar-o fa-fw"></i>
<span class=post-meta-item-text>Published at:</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2017-10-22">
2017-10-22
</time>
</span>
<span class=post-category>
&nbsp; | &nbsp;
<i class="fa fa-folder-o fa-fw"></i>
<span class=post-meta-item-text>Categories:</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing>
<a href=/en/categories/big-data itemprop=url rel=index style=text-decoration:underline>
<span itemprop=name>Big data</span>
</a>
&nbsp;
</span>
</span>
<span>
|
<i class="fa fa-file-word-o fa-fw"></i>
<span class=post-meta-item-text>Words:</span>
<span class=leancloud-world-count>1371 words</span>
</span>
<span>
|
<i class="fa fa-eye fa-fw"></i>
<span class=post-meta-item-text>Reading:</span>
<span class=leancloud-view-count>7 minutes</span>
</span>
<span id=/en/2017/10/22/ninfi-cluster-deploy-with-kerberos.html class=leancloud_visitors data-flag-title="Apache Nifi clustering and user authentication with kerberos">
|
<i class="fa fa-binoculars fa-fw"></i>
<span class=post-meta-item-text>Visited:</span>
<span class=leancloud-visitors-count></span>
</span>
</div>
</header>
<div class=post-body itemprop=articleBody>
<p>Recently, some of the lessons learned from the installation configuration are being shared with the help of the .Apache NIFI for contact with data streaming processing. This article is primarily about clusters and user rights, and the description of the &ldquo;Apache NIFI&rdquo; (<a href=https://nifi.apache.org/>https://nifi.apache.org/</a>) is not much of a description, with a direct reference to the official home page as follows:</p>
<p><img src=//lisenhui.gitee.io/imgs/blog/2017/10-22-Apache-NiFi-01.png alt=NiFi-01.png></p>
<p>Apahce NIFI&rsquo;s stand-alone operation is fairly simple, easy to use, and completely fooly. Download the decompression and perform &lsquo;nifi.sh start&rsquo; on the &lsquo;bin&rsquo; directory to open the browser input &lsquo;http://127.0.0.1:8080/nifi&rsquo; to see a simple and beautiful WEB UI. So what we&rsquo;re going to configure next is its cluster pattern, which is officially stated, with each node in the cluster performing the same tasks on the dataset, but each node is running on a different dataset (see the official documentation for detailed instructions( <a href=https://nifi.apache.org/docs.html>https://nifi.apache.org/docs.html</a></p>
<p><img src=//lisenhui.gitee.io/imgs/blog/2017/10-22-zero-master-cluster-http-access.png alt=zero-master-cluster-http-access.png></p>
<p>The system environment and software version</p>
<ul>
<li>
<p>CentOS7</p>
</li>
<li>
<p>JDK1.8.0_91</p>
</li>
<li>
<p>Nifi-1.4.0</p>
</li>
<li>
<p>Kerberos5</p>
</li>
</ul>
<p>(Other versions can refer to this article)</p>
<table>
<thead>
<tr>
<th style=text-align:center>HostName</th>
<th style=text-align:center>IP</th>
<th style=text-align:center>Services</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>centos7-master</td>
<td style=text-align:center>192.168.56.100</td>
<td style=text-align:center>Kerberos5 Server, Nifi Cluster Manager</td>
</tr>
<tr>
<td style=text-align:center>centos7-cluster01</td>
<td style=text-align:center>192.168.56.101</td>
<td style=text-align:center>Kerberos5 Client, Nifi Cluster</td>
</tr>
</tbody>
</table>
<p>Build the Kerberos 5 service</p>
<p>Install KDC services and configurations</p>
<p>Enter the Master machine and perform the following command to install the KDC service:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>yum -y install krb5-server krb5-libs krb5-workstation
</code></pre></div><p>Note: The &lsquo;krb5-auth-dialo&rsquo; component found in the test is not available and does not need to be installed</p>
<p>Modify the KDC default configuration</p>
<p>Go to the &lsquo;/etc&rsquo;directory to find&rsquo;/etc/krb5.conf&rsquo;file to openand modify, refer to the following:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback># Configuration snippets may be placed in this directory as well
includedir /etc/krb5.conf.d/

[logging]
 default = FILE:/var/log/krb5libs.log
 kdc = FILE:/var/log/krb5kdc.log
 admin_server = FILE:/var/log/kadmind.log

[libdefaults]
 dns_lookup_realm = false
 ticket_lifetime - 24 hours
 renew_lifetime - 7d
 forwardable = true
 rdns = false
 This comment needs to be turned on and fill in the default field
 default_realm = CENTOS7-MASTER.COM
 default_ccache_name = KEYRING:persistent:%{uid}

[realms]
  The EXAMPLE file here .COM your own domain
  CENTOS7-MASTER.COM = {
   kdc = centos7-master
   admin_server = centos7-master
   Add the default domain
   default_domain = CENTOS7-MASTER.COM
  }

[domain_realm]
  Change the EXAMPLE .COM to your own domain name
  .centos7-master.com = CENTOS7-MASTER.COM
  centos7-master.com = CENTOS7-MASTER.COM
</code></pre></div><p>Modify the KRB5KDC profile</p>
<p>Go to the'/etc&rsquo;directoryto find'/var/kerberos/krb5kdc/kdc.conf&rsquo;file to open, refer to the following modifications:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>[kdcdefaults]
 kdc_ports = 88
 kdc_tcp_ports = 88

[realms]
 Modify the EXAMPLE domain name .COM here
 CENTOS7-MASTER.COM = {
  #master_key_type = aes256-cts
  acl_file = /var/kerberos/krb5kdc/kadm5.acl
  dict_file = /usr/share/dict/words
  admin_keytab = /var/kerberos/krb5kdc/kadm5.keytab
  supported_enctypes = aes256-cts:normal aes128-cts:normal des3-hmac-sha1:normal arcfour-hmac:normal camellia256-cts:normal camellia128-cts:normal des-hmac-sha1:normal des-cbc-md5:normal des-cbc-crc:normal
  kdc_ports = 88
  kadmind_port = 749
 }
</code></pre></div><p>Initialize the database</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#666>[</span>root@centos7-master ~<span style=color:#666>]</span><span style=color:#080;font-style:italic># kdb5_util create -s</span>
Loading random data
Initializing database <span style=color:#b44>&#39;/var/kerberos/principal&#39;</span> <span style=color:#a2f;font-weight:700>for</span> realm <span style=color:#b44>&#39;CENTOS7-MASTER. COM&#39;</span>,
master key name <span style=color:#b44>&#39;K/M@CENTOS7-MASTER. COM&#39;</span>
You will be prompted <span style=color:#a2f;font-weight:700>for</span> the database Master Password.
It is important that you NOT FORGET this password.
Enter KDC database master key: 
Re-enter KDC database master key to verify: 
</code></pre></div><p>Modify the database permissions</p>
<p>Find the &lsquo;/var/kerberos/krb5kdc/kadm5.acl&rsquo; profile, add ACL permissions to the database administrator, and act on behalf of all permissions, as follows:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#666>[</span>root@centos7 master ~<span style=color:#666>]</span><span style=color:#080;font-style:italic># we /var/kerberos/krb5kdc/kadm5.acl</span>
*/admin@CENTOS7-MASTER.COM   *
</code></pre></div><p>Start the KDC service</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell>service krb5kdc start
service kadmin start
</code></pre></div><p>Create a database administrator</p>
<p>Refer to the following command to create an administrator user, save the password you set when you create it (if you forget to update laterusing the &lsquo;cpw&rsquo; command),and exportthe keytab</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#666>[</span>root@centos7-master ~<span style=color:#666>]</span><span style=color:#080;font-style:italic># kadmin.local -q &#34;addprinc root/admin&#34;</span>
Authenticating as principal root/admin@CENTOS7-MASTER.COM with password.
WARNING: no policy specified <span style=color:#a2f;font-weight:700>for</span> root/admin@CENTOS7-MASTER.COM; defaulting to no policy
Enter password <span style=color:#a2f;font-weight:700>for</span> principal <span style=color:#b44>&#34;root/admin@CENTOS7-MASTER.COM&#34;</span>:
Re-enter password <span style=color:#a2f;font-weight:700>for</span> principal <span style=color:#b44>&#34;root/admin@CENTOS7-MASTER.COM&#34;</span>:
Principal <span style=color:#b44>&#34;root/admin@CENTOS7-MASTER.COM&#34;</span> created.
<span style=color:#666>[</span>root@centos7-master ~<span style=color:#666>]</span><span style=color:#080;font-style:italic># kadmin.local</span>
kadmin: ktadd -k /data/root.keytab root/admin
kadmin: q
<span style=color:#666>[</span>root@centos7-master ~<span style=color:#666>]</span><span style=color:#080;font-style:italic># kinit root/admin</span>
</code></pre></div><p>Install the KDC Client service</p>
<p>Enter the machine from cluster and perform the following command to install the KDC Clienteservice:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell>yum -y install krb5-libs krb5-workstation
</code></pre></div><p>Update the configuration and test it</p>
<p>Copy the &lsquo;krb5.conf&rsquo;and&rsquo;root.keytab&rsquo;of the primarynode to the from node service, as follows:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>[root@centos7-cluster01 ~]# scp root@centos7-master:/etc/krb5.conf /etc/krb5.conf
[root@centos7-cluster01 ~]# scp root@centos7-master:/data/root.keytab /data/root.keytab
[root@centos7-cluster01 ~]# kadmin -p root/admin
Authenticating as principal root/admin with password.
Password for root/admin@CENTOS7-MASTER.COM: 
kadmin: 
</code></pre></div><p>Copy the keytab file</p>
<p>Copy the&rsquo;root.keytab&rsquo;to the &lsquo;/data/root.keytab&rsquo;directory,note that this refers to all machines</p>
<p>Create a Nifi service certificate</p>
<p>Create a certificate</p>
<p>Unzim the &lsquo;nifi-toolkit-1.4.0-bin.tar.gz file and enter the &lsquo;bin&rsquo; directory to execute the following commands:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=color:#666>[</span>root@centos7-master ~<span style=color:#666>]</span><span style=color:#080;font-style:italic># ./tls-toolkit.sh standalone -n &#39;centos7-master, centos7-cluster01&#39; -C &#39;CN=admin, OU=ApacheNIFI&#39; -o &#39;./target&#39; -f &#39;/usr/local/bin/nifi-ncm/conf/nifi.properties&#39;</span>
<span style=color:#666>[</span>root@centos7-master target<span style=color:#666>]</span><span style=color:#080;font-style:italic># tree</span>
.
├── centos7-cluster01
│   ├── keystore.jks
│   ├── nifi.properties
│   └── truststore.jks
├── centos7-master
│   ├── keystore.jks
│   ├── nifi.properties
│   └── truststore.jks
├── <span style=color:#b8860b>CN</span><span style=color:#666>=</span><span style=color:#b8860b>admin_OU</span><span style=color:#666>=</span>ApacheNIFI.p12
├── <span style=color:#b8860b>CN</span><span style=color:#666>=</span><span style=color:#b8860b>admin_OU</span><span style=color:#666>=</span>ApacheNIFI.password
yes-true.pem
└── nifi-key.key
</code></pre></div><ul>
<li>-n indicates the hostname of the machine</li>
</ul>
<hr>
<p>The directory of the output of -o</p>
<ul>
<li>-f Nifi&rsquo;s profile location</li>
</ul>
<p>Copy the certificate</p>
<p>The copy generates a good certificate to the conf folder in the &lsquo;NIFI&rsquo; installation directory under the primary node server, as follows:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>[root@centos7-master target]# scp centos7-cluster01/* centos7-cluster01:/usr/local/bin/nifi-cluster01/conf
[root@centos7-master target]# cp target/centos7-master/* /usr/local/bin/nifi-ncm/conf/
</code></pre></div><p>Configure the Zookeeper service</p>
<p>Note: All master-access nodes require action</p>
<p>Create an id file</p>
<p>Go into the NIFI installation directory, create a &lsquo;state/zookeeper&rsquo;directory and a&rsquo;myid&rsquo;file, and then write thecorresponding ID to the file as follows:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>[root@centos7-master nifi-ncm]# mkdir -p state/zookeeper
[root@centos7-master nifi-ncm]# echo -n &#39;1&#39; &gt; state/zookeeper/myid
</code></pre></div><p>Note: The myid created from the node is 2, such as: &lsquo;echo -n &lsquo;2&rsquo; sgt; state/zookeyer/myid&rsquo;</p>
<p>Modify the profile</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>clientPort=2181
initLimit=10
autopurge.purgeInterval=24
syncLimit=5
tickTime=2000
dataDir=./state/zookeeper
autopurge.snapRetainCount=30

#
# Specifies the servers that are part of this zookeeper ensemble. For
# every NiFi instance running an embedded zookeeper, there needs to be
# a server entry below. For instance:
#
# server.1=nifi-node1-hostname:2888:3888
# server.2=nifi-node2-hostname:2888:3888
# server.3=nifi-node3-hostname:2888:3888
#
# The index of the server corresponds to the myid file that gets created
# in the dataDir of each node running an embedded zookeeper. See the
# administration guide for more details.
#

Note that it is modified to your corresponding server address
server.1=centos7-master:2888:3888
server.2=centos7-cluster01:2888:3888
</code></pre></div><p>Update the status configuration</p>
<p>Go to the Nifif installation directory to modify the &lsquo;conf/state-management.xml&rsquo; configurationand add the connection string under thezk-providernode</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:green;font-weight:700>&lt;cluster-provider&gt;</span>
  <span style=color:green;font-weight:700>&lt;id&gt;</span>zk-provider<span style=color:green;font-weight:700>&lt;/id&gt;</span>    
 <span style=color:green;font-weight:700>&lt;class&gt;</span>org.apache.nifi.controller.state.providers.zookeeper.ZooKeeperStateProvider<span style=color:green;font-weight:700>&lt;/class&gt;</span>
   <span style=color:green;font-weight:700>&lt;property</span> <span style=color:#b44>name=</span><span style=color:#b44>&#34;Connect String&#34;</span><span style=color:green;font-weight:700>&gt;</span>centos7-master:2181,centos7-cluster01:2181<span style=color:green;font-weight:700>&lt;/property&gt;</span>
   <span style=color:green;font-weight:700>&lt;property</span> <span style=color:#b44>name=</span><span style=color:#b44>&#34;Root Node&#34;</span><span style=color:green;font-weight:700>&gt;</span>/nifi<span style=color:green;font-weight:700>&lt;/property&gt;</span>
   <span style=color:green;font-weight:700>&lt;property</span> <span style=color:#b44>name=</span><span style=color:#b44>&#34;Session Timeout&#34;</span><span style=color:green;font-weight:700>&gt;</span>10 seconds<span style=color:green;font-weight:700>&lt;/property&gt;</span>
   <span style=color:green;font-weight:700>&lt;property</span> <span style=color:#b44>name=</span><span style=color:#b44>&#34;Access Control&#34;</span><span style=color:green;font-weight:700>&gt;</span>Open<span style=color:green;font-weight:700>&lt;/property&gt;</span>
<span style=color:green;font-weight:700>&lt;/cluster-provider&gt;</span>
</code></pre></div><h2 id=update-nifi-deployment>Update NIFI Deployment</h2>
<p>Go to the Nifif installation directory to modify the &lsquo;conf/nifi.properties&rsquo;file, set the built-in &lsquo;zookeeper&rsquo; boot and &lsquo;cluster&rsquo; to &lsquo;true&rsquo;, as follows:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>nifi.state.management.embedded.zookeeper.start=true

nifi.cluster.is.node=true

# zookeeper properties, used for cluster management #
nifi.zookeeper.connect.string=centos7-master:2181,centos7-cluster01:2181
nifi.zookeeper.connect.timeout
nifi.zookeeper.session.timeout
nifi.zookeeper.root.node=/nifi
</code></pre></div><p>Configure Nifi Admin initialization</p>
<h2 id=update-nifi-deployment-1>Update NIFI Deployment</h2>
<p>Go to the Nifif installation directory to modify the&rsquo;conf/nifi.properties&rsquo;fileand add the &lsquo;kerberos5&rsquo; login fit as follows:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>nifi.kerberos.krb5.file=/etc/krb5.conf

# kerberos service principal #
nifi.kerberos.service.principal=root/admin@CENTOS7-MASTER.COM
nifi.kerberos.service.keytab.location=/data/root.keytab
</code></pre></div><p>Update the user configuration</p>
<p>Go to the conf directory in the Nifif installation directory, add &lsquo;authorizer&rsquo; to &lsquo;authorizers.xml&rsquo;, open the &lsquo;file-provider&rsquo; node comment, and add the following:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:green;font-weight:700>&lt;authorizer&gt;</span>
  <span style=color:green;font-weight:700>&lt;identifier&gt;</span>file-provider<span style=color:green;font-weight:700>&lt;/identifier&gt;</span>
  <span style=color:green;font-weight:700>&lt;class&gt;</span>org.apache.nifi.authorization.FileAuthorizer<span style=color:green;font-weight:700>&lt;/class&gt;</span>
  <span style=color:green;font-weight:700>&lt;property</span> <span style=color:#b44>name=</span><span style=color:#b44>&#34;Authorizations File&#34;</span><span style=color:green;font-weight:700>&gt;</span>./conf/authorizations.xml<span style=color:green;font-weight:700>&lt;/property&gt;</span>
  <span style=color:green;font-weight:700>&lt;property</span> <span style=color:#b44>name=</span><span style=color:#b44>&#34;Users File&#34;</span><span style=color:green;font-weight:700>&gt;</span>./conf/users.xml<span style=color:green;font-weight:700>&lt;/property&gt;</span>
  <span style=color:green;font-weight:700>&lt;property</span> <span style=color:#b44>name=</span><span style=color:#b44>&#34;Initial Admin Identity&#34;</span><span style=color:green;font-weight:700>&gt;</span>root/admin@CENTOS7-MASTER.COM<span style=color:green;font-weight:700>&lt;/property&gt;</span>
  <span style=color:green;font-weight:700>&lt;property</span> <span style=color:#b44>name=</span><span style=color:#b44>&#34;Legacy Authorized Users File&#34;</span><span style=color:green;font-weight:700>&gt;&lt;/property&gt;</span>

  <span style=color:green;font-weight:700>&lt;property</span> <span style=color:#b44>name=</span><span style=color:#b44>&#34;Node Identity 1&#34;</span><span style=color:green;font-weight:700>&gt;</span>CN=centos7-master, OU=NIFI<span style=color:green;font-weight:700>&lt;/property&gt;</span>
  <span style=color:green;font-weight:700>&lt;property</span> <span style=color:#b44>name=</span><span style=color:#b44>&#34;Node Identity 2&#34;</span><span style=color:green;font-weight:700>&gt;</span>CN=centos7-cluster01, OU=NIFI<span style=color:green;font-weight:700>&lt;/property&gt;</span>
<span style=color:green;font-weight:700>&lt;/authorizer&gt;</span>
</code></pre></div><p>Update the login configuration</p>
<p>Go to the conf directory in the Nifif installation directory, modify the &lsquo;login-identity-providers.xml&rsquo;file, andopen the&rsquo;kerberos-provider&rsquo;node comment:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:green;font-weight:700>&lt;provider&gt;</span>
  <span style=color:green;font-weight:700>&lt;identifier&gt;</span>kerberos-provider<span style=color:green;font-weight:700>&lt;/identifier&gt;</span>
  <span style=color:green;font-weight:700>&lt;class&gt;</span>org.apache.nifi.kerberos.KerberosProvider<span style=color:green;font-weight:700>&lt;/class&gt;</span>
  <span style=color:green;font-weight:700>&lt;property</span> <span style=color:#b44>name=</span><span style=color:#b44>&#34;Default Realm&#34;</span><span style=color:green;font-weight:700>&gt;</span>CENTOS7-MASTER.COM<span style=color:green;font-weight:700>&lt;/property&gt;</span>
  <span style=color:green;font-weight:700>&lt;property</span> <span style=color:#b44>name=</span><span style=color:#b44>&#34;Kerberos Config File&#34;</span><span style=color:green;font-weight:700>&gt;</span>/etc/krb5.conf<span style=color:green;font-weight:700>&lt;/property&gt;</span>
  <span style=color:green;font-weight:700>&lt;property</span> <span style=color:#b44>name=</span><span style=color:#b44>&#34;Authentication Expiration&#34;</span><span style=color:green;font-weight:700>&gt;</span>12 hours<span style=color:green;font-weight:700>&lt;/property&gt;</span>
<span style=color:green;font-weight:700>&lt;/provider&gt;</span>
</code></pre></div><p>Start the NIFI service</p>
<p>Start the NIFI of the primary node, then start the NIFI from the node, execute the command &lsquo;./bin/nifi.sh start&rsquo;, then open the browser input &lsquo;https://centos7-master:9443/nifi/&rsquo; and you will jump to the login page and enter the user and password created in step 1 to log in successfully. The interface appears as follows:</p>
<p><img src=//lisenhui.gitee.io/imgs/blog/2017/10-22-Apache-NiFi-02.png alt="Apache NiFi02"></p>
<p><img src=//lisenhui.gitee.io/imgs/blog/2017/10-22-Apache-NiFi-03.png alt="Apache NiFi03"></p>
<p>As shown in the above two figures, in the upper left corner of the interface can clearly see that the current number of nodes is 2, the user is &lsquo;<a href=mailto:root/admin@CENTOS7-MASTER.COM>root/admin@CENTOS7-MASTER.COM</a>&rsquo;, where &lsquo;centos7-master&rsquo; is the coordinator, &lsquo;centos 7-cluster01&rsquo; is the main node, the main menu also added &lsquo;Cluster&rsquo;, &lsquo;User&rsquo; and &lsquo;Policies&rsquo; options.</p>
<p>At this point, &lsquo;Apache NIFI&rsquo; cluster services and user authentication are complete, and then we can take the next step.</p>
<p>The pits encountered:
The user name or password is not valid when you log on for the first time, and the user&rsquo;s password can be updated via kadmin</p>
<ul>
<li>After successful login, the user is prompted that there is no corresponding policy, just restart the NIFI service</li>
</ul>
<p>Citation reference</p>
<ul>
<li><a href=https://community.hortonworks.com/articles/34147/nifi-security-user-authentication-with-kerberos.html>nifi-security-user-authentication-with-kerberos.html</a>
-Nifi- Build) (<a href="http://blog.csdn.net/sinat_34233802/article/details/68942176?locationNum=1&fps=1)">http://blog.csdn.net/sinat_34233802/article/details/68942176?locationNum=1&fps=1)</a>.
-<a href=http://blog.csdn.net/wulantian/article/details/42418231>The principle of kerberos certification &mdash; is very detailed and easy to understand</a>.</li>
<li><a href=http://blog.csdn.net/post_yuan/article/details/54406148>Kerberos Basic Installation and Configuration</a></li>
</ul>
<p>Bounty received
Thank you for your generosity!</p>
<table>
<thead>
<tr>
<th style=text-align:center>The serial number</th>
<th style=text-align:center>Nickname</th>
<th style=text-align:center>Source</th>
<th style=text-align:center>The amount (yuan)</th>
<th style=text-align:center>Leave a message</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>1</td>
<td style=text-align:center>Lin is a common</td>
<td style=text-align:center>WeChat</td>
<td style=text-align:center>2</td>
<td style=text-align:center>Thanks to bloggers, thanks for</td>
</tr>
</tbody>
</table>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/en/tags/big-data rel=tag title="Big data">#Big data#</a>
<a href=/en/tags/nifi rel=tag title=Nifi>#Nifi#</a>
</div>
<div class=addthis_inline_share_toolbox></div>
<div class=post-nav>
<div class=article-copyright>
<div class=article-copyright-img>
<img src=/img/qq_qrcode.png width=129px height=129px>
<div style=text-align:center>QQ QrCode</div>
</div>
<div class=article-copyright-info>
<p>
<span>Declaration：</span>Apache Nifi clustering and user authentication with kerberos
</p>
<p>
<span>Link：</span>https://lisenhui.cn/en/2017/10/22/ninfi-cluster-deploy-with-kerberos.html
</p>
<p>
<span>Author：</span>Elkan.Li
</p>
<p>
<span>Declaration： </span>This blog post article is under the <a href=https://creativecommons.org/licenses/by-nc-sa/3.0/ target=_blank style=text-decoration:underline>CC BY-NC-SA 3.0</a> license,Please indicate the source!
</p>
</div>
</div>
<div class=clear></div>
</div>
<div class=reward-qr-info>
<div>If it can help you, you can give tips for blogger that how much you want. ^_^</div>
<button id=rewardButton disable=enable onclick="var qr=document.getElementById('QR');qr.style.display==='none'?qr.style.display='block':qr.style.display='none'">
<span>Reward</span>
</button>
<div id=QR style=display:none>
<div id=wechat style=display:inline-block>
<img id=wechat_qr src=/img/wechat-pay.png alt="WeChat Pay">
<p>Wechat Pay</p>
</div>
<div id=alipay style=display:inline-block>
<img id=alipay_qr src=/img/ali-pay.png alt=Alipay>
<p>Ali Pay</p>
</div>
</div>
</div>
<div class=post-nav>
<div class="post-nav-next post-nav-item">
<a href=https://lisenhui.cn/en/2017/10/26/nifi-windows-local-cluster.html rel=next title="Apache Nifi builds pseudo-clusters and certificate logins in a Windows environment">
<i class="fa fa-chevron-left"></i> Apache Nifi builds pseudo-clusters and certificate logins in a Windows environment
</a>
</div>
<div class="post-nav-prev post-nav-item">
<a href=https://lisenhui.cn/en/2017/10/18/ambari-monitor-status-issues.html rel=prev title="An issue with the service in Ambari that is functioning properly but the service stops">
An issue with the service in Ambari that is functioning properly but the service stops
<i class="fa fa-chevron-right"></i>
</a>
</div>
</div>
<div id=wcomments></div>
</footer>
</article>
</section>
</div>
</div>
<div class=sidebar-toggle>
<div class=sidebar-toggle-line-wrap>
<span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
</div>
</div>
<aside id=sidebar class=sidebar>
<div class=sidebar-inner>
<section class="site-overview sidebar-panel sidebar-panel-active">
<div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person>
<img class=site-author-image itemprop=image src=/img/avatar.png alt=Elkan.Li>
<p class=site-author-name itemprop=name>Elkan.Li</p>
<p class="site-description motion-element" itemprop=description>
Never forget your dreams！
</p>
</div>
<nav class="site-state motion-element">
<div class="site-state-item site-state-posts">
<a href=/en/post/>
<span class=site-state-item-count>55</span>
<span class=site-state-item-name>Blogs</span>
</a>
</div>
<div class="site-state-item site-state-categories">
<a href=/en/categories/>
<span class=site-state-item-count>27</span>
<span class=site-state-item-name>Categories</span>
</a>
</div>
<div class="site-state-item site-state-tags">
<a href=/en/tags/>
<span class=site-state-item-count>64</span>
<span class=site-state-item-name>Tags</span>
</a>
</div>
</nav>
<div class="links-of-author motion-element">
<span class=links-of-author-item>
<a href=https://github.com/elkan1788/ target=_blank title=GitHub>
<i class="fa fa-fw fa-github"></i>
GitHub
</a>
</span>
<span class=links-of-author-item>
<a href=https://www.zhihu.com/people/fan-meng-xing-chen-1 target=_blank title=ZhiHu>
<i class="fa fa-fw fa-globe"></i>
ZhiHu
</a>
</span>
</div>
<div class="links-of-blogroll motion-element links-of-blogroll-inline">
<div class=links-of-blogroll-title>
<i class="fa fa-fw fa-globe"></i>
Links
</div>
<ul class=links-of-blogroll-list>
<li class=links-of-blogroll-item>
<a href=https://nutzam.com/ title=Nutz target=_blank>Nutz</a>
</li>
<li class=links-of-blogroll-item>
<a href=https://jfinal.com/ title=JFinal target=_blank>JFinal</a>
</li>
<li class=links-of-blogroll-item>
<a href=http://wendal.net/ title=Wendal target=_blank>Wendal</a>
</li>
<li class=links-of-blogroll-item>
<a href=https://www.liaoxuefeng.com/ title=LiaoXueFeng target=_blank>LiaoXueFeng</a>
</li>
<li class=links-of-blogroll-item>
<a href=https://zhaohaiyu.com/ title="haiyux's blog" target=_blank>haiyux's blog</a>
</li>
</ul>
</div>
<div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline">
<div class=tagcloud-of-blogroll-title>
<i class="fa fa-fw fa-tags"></i>
TagCloud
</div>
<ul class=tagcloud-of-blogroll-list>
<li class=tagcloud-of-blogroll-item>
<a href=/en/tags/big-data>Big data</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/en/tags/java>Java</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/en/tags/linux>Linux</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/en/tags/blog>Blog</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/en/tags/git>Git</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/en/tags/github>Github</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/en/tags/kindeditor>Kindeditor</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/en/tags/python>Python</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/en/tags/axure>Axure</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/en/tags/front>Front</a>
</li>
</ul>
</div>
<div class="links-of-blogroll motion-element inline">
<script type=text/javascript src="//rf.revolvermaps.com/0/0/6.js?i=Your%20RevolverMapId&m=7&c=e63100&cr1=ffffff&f=arial&l=0&bv=90&lx=-420&ly=420&hi=20&he=7&hc=a8ddff&rs=80" async></script>
</div>
</section>
</div>
</aside>
</div>
</main>
<footer id=footer class=footer>
<div class=footer-inner>
<div class=copyright>
<span class=copyright-year>
&copy; 2010 - 2022
</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>Loving life and dreams.</span>
</div>
<div class=powered-info>
<span class=powered-by>
Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.87.0</a>
</span>
<span class=separator-line>/</span>
<span class=theme-info>
Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank> NexT
</a>
</span>
</div>
<div class=vistor-info>
<span class=cnzz_icon id="cnzz_stat_icon_Your CNNZSiteId">
<a href="//www.cnzz.com/stat/website.php?web_id=Your%20CNNZSiteId" target=_blank title=站长统计>
<img border=0 hspace=0 vspace=0 src=//icon.cnzz.com/img/pic1.gif>
</a>
</span>
<script type=text/javascript>(function(){var a=document.createElement('script'),b;a.type='text/javascript',a.async=!0,a.charset='utf-8',a.src='https://s4.cnzz.com/z_stat.php?id=Your CNNZSiteId&show=pic1',b=document.getElementsByTagName('script')[0],b.parentNode.insertBefore(a,b)})()</script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span class=site-uv>
<i class="fa fa-user"></i>
<span class=busuanzi-value id=busuanzi_value_site_uv></span>
</span>
<span class=separator-line>/</span>
<span class=site-pv>
<i class="fa fa-eye"></i>
<span class=busuanzi-value id=busuanzi_value_site_pv></span>
</span>
</div>
<div class=license-info>
<span class=storage-info>
Storage by
<a href=https://www.gitee.com/ style=font-weight:700 target=_blank>Gitee Storage</a>
</span>
<span class=separator-line>/</span>
<span class=license-num>
<a href=http://beian.miit.gov.cn target=_blank>ICP.NO 18047355</a>
</span>
</div>
</div>
</footer>
<div class=back-to-top>
<i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span>
</div>
</div>
<script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script>
<script type=text/javascript src=/js/search.js></script>
<script type=text/javascript src=/js/affix.js></script>
<script type=text/javascript src=/js/scrollspy.js></script>
<script type=text/javascript>function detectIE(){var a=window.navigator.userAgent,b=a.indexOf('MSIE '),c=a.indexOf('Trident/'),d=a.indexOf('Edge/');return b>0||c>0||d>0?-1:1}function getCntViewHeight(){var b=$('#content').height(),a=$(window).height(),c=b>a?b-a:$(document).height()-a;return c}function getScrollbarWidth(){var a=$('<div />').addClass('scrollbar-measure').prependTo('body'),b=a[0],c=b.offsetWidth-b.clientWidth;return a.remove(),c}function registerBackTop(){var b=50,a=$('.back-to-top');$(window).on('scroll',function(){var d,e,f,c,g;a.toggleClass('back-to-top-on',window.pageYOffset>b),d=$(window).scrollTop(),e=getCntViewHeight(),f=d/e,c=Math.round(f*100),g=c>100?100:c,$('#scrollpercent>span').html(g)}),a.on('click',function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){var a='.post-toc',d=$(a),b='.active-current';d.on('activate.bs.scrollspy',function(){var b=$(a+' .active').last();c(),b.addClass('active-current')}).on('clear.bs.scrollspy',c),$('body').scrollspy({target:a});function c(){$(a+' '+b).removeClass(b.substring(1))}}function initAffix(){var a=$('.header-inner').height(),b=parseInt($('.main').css('padding-bottom'),10),c=a+10;$('.sidebar-inner').affix({offset:{top:c,bottom:b}}),$(document).on('affixed.bs.affix',function(){updateTOCHeight(document.body.clientHeight-100)})}function initTOCDimension(){var a,b;$(window).on('resize',function(){a&&clearTimeout(a),a=setTimeout(function(){var a=document.body.clientHeight-100;updateTOCHeight(a)},0)}),updateTOCHeight(document.body.clientHeight-100),b=getScrollbarWidth(),$('.post-toc').css('width','calc(100% + '+b+'px)')}function updateTOCHeight(a){a=a||'auto',$('.post-toc').css('max-height',a)}$(function(){var b=$('.header-inner').height()+10,c,d,a,e;$('#sidebar').css({'margin-top':b}).show(),c=parseInt($('#sidebar').css('margin-top')),d=parseInt($('.sidebar-inner').css('height')),a=c+d,e=$('.content-wrap').height(),e<a&&$('.content-wrap').css('min-height',a),$('.site-nav-toggle').on('click',function(){var a=$('.site-nav'),e=$('.toggle'),b='site-nav-on',f='toggle-close',c=a.hasClass(b),g=c?'slideUp':'slideDown',d=c?'removeClass':'addClass';a.stop()[g]('normal',function(){a[d](b),e[d](f)})}),registerBackTop(),initScrollSpy(),initAffix(),initTOCDimension(),$('.sidebar-nav-toc').click(function(){$(this).addClass('sidebar-nav-active'),$(this).next().removeClass('sidebar-nav-active'),$('.'+$(this).next().attr('data-target')).toggle(500),$('.'+$(this).attr('data-target')).toggle(500)}),$('.sidebar-nav-overview').click(function(){$(this).addClass('sidebar-nav-active'),$(this).prev().removeClass('sidebar-nav-active'),$('.'+$(this).prev().attr('data-target')).toggle(500),$('.'+$(this).attr('data-target')).toggle(500)})})</script>
<script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script>
<script type=text/javascript>$(function(){$('.post-body').viewer()})</script>
<script type=text/javascript>$(function(){detectIE()>0?$.getScript(document.location.protocol+'//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js',function(){new Waline({el:'#wcomments',visitor:!0,avatar:'wavatar',avatarCDN:'https://sdn.geekzu.org/avatar/',avatarForce:!1,wordLimit:'200',placeholder:' Just do what you want leave here, and don\u0027t forget give your email to make exchange. ^_^ ',requiredFields:['nick','mail'],serverURL:"Your WalineSerURL",lang:"en"})}):$('#wcomments').html('Sorry, Waline plugin doesn\u0027t support IE or Edge, Please swithc to Chrome browser.')})</script>
<script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=Your%20AddthisPubid"></script>
<script>(function(){var a=document.createElement('script'),c=window.location.protocol.split(':')[0],b;c==='https'?a.src='https://zz.bdstatic.com/linksubmit/push.js':a.src='http://push.zhanzhang.baidu.com/push.js',b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script>
<script type=text/javascript>$(function(){var b,a;document.body.clientWidth>900&&(b=document.getElementsByTagName('HEAD').item(0),a=document.createElement("script"),a.type="text/javascript",a.innerHTML='(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",(\'https:\' == document.location.protocol ? \'https:\' : \'http:\') + "//widget.daovoice.io/widget/Your DaoVoiceId.js","daovoice")',b.appendChild(a),daovoice('init',{app_id:"Your DaoVoiceId"}),daovoice('update'))})</script>
</body>
</html>